<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Direct Linker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
    <h1 class="mb-4 text-center">Direct Linker</h1>

    <div class="card p-4 shadow-sm">
        <form id="upload-form" enctype="multipart/form-data">
            <div class="mb-3">
                <label for="file" class="form-label">Выберите файл для загрузки</label>
                <input class="form-control" type="file" id="file" name="file" required>
            </div>
            <button class="btn btn-primary" type="submit">Загрузить</button>
        </form>

        <div id="result" class="mt-3"></div>
    </div>
</div>

<script>
document.getElementById('upload-form').addEventListener('submit', async function (e) {
    e.preventDefault();
    const fileInput = document.getElementById('file');
    if (!fileInput.files.length) return;

    const formData = new FormData(this);

    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.textContent = "Uploading...";

    try {
        const response = await fetch('/upload', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '';

        if (data.url) {
            resultDiv.innerHTML = `
                <div class="mb-3">
                    <label for="file" class="form-label">Ссылка на скачивание</label>
                    <div class="input-group mt-3">
                        <input type="text" class="form-control" value="${window.location.origin}${data.url}" id="file-link" readonly>
                        <button class="btn btn-outline-secondary" type="button" id="copy-btn">Copy</button>
                    </div>
                </div>
            `;

            document.getElementById('copy-btn').addEventListener('click', function () {
                const linkInput = document.getElementById('file-link');
                linkInput.select();
                linkInput.setSelectionRange(0, 99999);
                navigator.clipboard.writeText(linkInput.value);
                alert("Ссылка скопирована");
            });

            fileInput.value = '';
        } else {
            resultDiv.innerHTML = `
                <div class="alert alert-danger mt-3">
                    Ошибка при загрузке файла.
                </div>
            `;
        }
    } catch (err) {
        alert("Произошла ошибка при загрузке файла.");
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Upload";
    }
});
</script>

</body>
</html>
